const fs = require("fs");
const path = require("path");

function isDir(target) {
    return fs.lstatSync(target).isDirectory();
}

function removeNodeModules(folderPath) {
    if (folderPath.slice(0, 1) === ".") {
        // supplied relative path
        folderPath = path.join(__dirname, folderPath);
    }

    if (!fs.existsSync(folderPath)) {
        console.log("path does not exist.");
        process.exit(1);
    }

    // iterate recursively thru all folder
    const dir = fs.readdirSync(folderPath);
    for (const ii in dir) {
        const item = dir[ii];

        const itemPath = path.join(folderPath, item);

        if (!isDir(itemPath)) {
            continue;
        }

        // is a directory

        // if is node_module,
        if (item === "node_modules") {
            console.log("Removing ", itemPath);

            // then delete
            fs.rmSync(itemPath, {force: true, recursive: true});
        }else{
            // else open and iterate again
            removeNodeModules(itemPath);
        }
    }
}

function main() {
    let destination = process.argv[2];

    // look for node modules
    // remove if exists
    removeNodeModules(destination);
}

main();
